# Sector Analysis for Renaissance Stock Ranking System

## Overview

The sector analysis component enhances the Renaissance Stock Ranking System by providing sector-based insights derived from the individual stock rankings. While the core system ranks stocks based on yearly returns, this module adds another dimension by analyzing performance, concentration, and financial metrics at the sector level.

This additional perspective enables portfolio managers to:

- Identify outperforming and underperforming sectors
- Understand sector dynamics and trends
- Make informed sector allocation decisions
- Find top-performing stocks within specific sectors
- Balance sector exposure for optimal diversification

## Table of Contents

1. [Key Features](#key-features)
2. [How It Works](#how-it-works)
3. [Usage Guide](#usage-guide)
4. [Input Data](#input-data)
5. [Output Files and Visualizations](#output-files-and-visualizations)
6. [Interpretation Guide](#interpretation-guide)
7. [Advanced Applications](#advanced-applications)
8. [Technical Implementation Notes](#technical-implementation-notes)

## Key Features

*   **Sector Performance Analysis**: Calculates and ranks sectors based on average/median stock returns, volatility, etc.
*   **Financial Metrics Integration**: Incorporates metrics like P/E, P/B, ROE from `financial_metrics.csv` for deeper sector comparisons.
*   **Sector Concentration Analysis**: Shows the distribution of stocks across sectors.
*   **Top Stocks Identification**: Lists the highest-ranked stocks within each sector.
*   **Report Generation**: Produces CSV files and potentially Excel reports summarizing the findings.

## How It Works

The sector analysis process typically involves:

1.  **Loading Data**: Reads the main stock ranking results (e.g., `NIFTY500_Rankings_*.xlsx`), the NIFTY 500 list (`nifty500_list.csv` which **must** contain a `Sector` column), and optionally the financial metrics (`financial_metrics.csv`).
2.  **Merging Data**: Combines these data sources using the `ISIN` as the key.
3.  **Calculating Sector Metrics**: Aggregates stock-level data (returns, ranks, financial metrics) to calculate statistics for each sector.
4.  **Analyzing Concentration**: Determines the number and percentage of stocks in each sector.
5.  **Identifying Top Stocks**: Filters the rankings to show the leading stocks within each sector.
6.  **Saving Results**: Writes the analysis results to files in the specified output directory (usually `output/sector_analysis/`).

## Usage Guide

The sector analysis is run using the `renaissance-analyze` command-line tool.

### Basic Usage

Ensure you have already run `renaissance-rank` to generate the ranking results.

```bash
# Activate your virtual environment
renaissance-analyze
```

This command will automatically look for the necessary input files in their default locations (`output/` for rankings, `data/` for NIFTY 500 list and metrics) and save the results to `output/sector_analysis/`.

### Command-Line Options

Use `--help` to see all options:
```bash
renaissance-analyze --help
```

Common options:
*   `--rankings-file <path>`: Specify the path to the stock rankings Excel/CSV file (if not in the default `output/` directory or named differently).
*   `--nifty500-file <path>`: Specify the path to the NIFTY 500 list CSV (must contain a `Sector` column).
*   `--metrics-file <path>`: Specify the path to the financial metrics CSV (optional, but enhances analysis).
*   `--output-dir <path>`: Directory to save sector analysis outputs (default: `output/sector_analysis/`).

**Example:**
```bash
renaissance-analyze --rankings-file results/NIFTY500_Rankings_20240131.xlsx --output-dir analysis_results/sector
```

### Integration with Main Workflow

Sector analysis is typically the third step in the workflow:

1.  `renaissance-extract` (Get data)
2.  `renaissance-rank` (Calculate rankings)
3.  **`renaissance-analyze` (Analyze sectors)**
4.  `renaissance-visualize` (Generate charts)

## Input Data

The `renaissance-analyze` command requires the following input data:

1.  **Stock Rankings File**: Typically an Excel file (`.xlsx`) generated by `renaissance-rank`, located in the `output/` directory. Must contain columns like `ISIN`, `Name`, `YearlyReturn`, `Rank`.
2.  **NIFTY 500 List File**: The `nifty500_list.csv` file located in the `data/` directory. **Crucially, this file must contain a `Sector` column** with the GICS sector classification for each stock.
3.  **Financial Metrics File (Optional)**: The `financial_metrics.csv` file located in the `data/` directory. If provided, it must contain an `ISIN` column and columns for desired metrics (e.g., `PE_Ratio`, `ROE`).

*(Use command-line options like `--rankings-file` if your files are named differently or located elsewhere).*

## Output Files and Visualizations

Outputs are saved to the directory specified by `--output-dir` (default: `output/sector_analysis/`).

### 1. Sector Performance File (`sector_performance.csv`)
*   **Content**: Aggregated performance metrics per sector (mean/median return, std dev, avg rank, stock count).
*   **Use**: Identify top/bottom performing sectors based on returns and risk.

### 2. Sector Concentration File (`sector_concentration.csv`)
*   **Content**: Number and percentage of stocks in each sector.
*   **Use**: Understand index composition and potential concentration risks.

### 3. Financial Metrics By Sector (`sector_financial_metrics.csv`)
*   **Content**: Aggregated financial metrics (e.g., average P/E, median ROE) per sector. *Generated only if `financial_metrics.csv` is provided as input.*
*   **Use**: Compare sector valuations and financial health.

### 4. Top Stocks By Sector (`top_stocks_by_sector.csv` or similar)
*   **Content**: Lists the highest-ranked (by return) stocks within each sector, possibly with their key metrics.
*   **Use**: Find potential investment ideas within specific industries.

### 5. Consolidated Report (`sector_analysis_report.xlsx` - Optional)
*   **Content**: May combine the above tables and potentially basic charts into a single Excel file for easier review.

*(Note: Exact filenames and the inclusion of an Excel report may vary slightly based on the current implementation in `renaissance/analysis/sector_analysis.py`).*

## Interpretation Guide

*   **Sector Performance**: Look for high average returns combined with reasonable volatility (standard deviation). Consistently high ranks indicate persistent strength.
*   **Financial Metrics**: Compare metrics like P/E or P/B across sectors to identify potentially over/undervalued areas. Compare ROE to assess profitability.
*   **Concentration**: Be aware of overly dominant sectors in the index, as they can drive overall market performance.
*   **Top Stocks**: Use this list as a starting point for deeper stock-specific research within promising sectors.

## Advanced Applications

*   **Sector Rotation**: Use performance trends to overweight strong sectors and underweight weak ones.
*   **Relative Value**: Identify sectors trading at historical valuation discounts or premiums.
*   **Risk Management**: Ensure portfolio sector weights align with risk tolerance and diversification goals.

## Technical Implementation Notes

*   The core logic resides in `renaissance/analysis/sector_analysis.py`.
*   The primary function is likely `integrate_financial_metrics` (or similar), which handles merging data and calculating sector statistics using pandas `groupby()` operations.
*   The analysis relies heavily on the quality and completeness of the `Sector` column in `nifty500_list.csv`.
*   Financial metric analysis depends on the presence and content of `financial_metrics.csv`.

---

For additional information, see the [Main User Guide](user_guide.md) and the code in `renaissance/analysis/sector_analysis.py`. 